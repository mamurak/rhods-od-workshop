<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2.4 Calling the API from an Application :: Object Detection Workshop</title>
    <link rel="canonical" href="https://mamurak.github.io/rhods-od-workshop/rhods-od-workshop/2-04-calling-from-application.html">
    <link rel="prev" href="2-03-testing-deployment.html">
    <link rel="next" href="3-01-running-the-model-offline.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://mamurak.github.io/rhods-od-workshop">Object Detection Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhods-od-workshop" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">1. Jupyter Notebooks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-01-project-setup.html">1. Settin up your Data Science Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-02-jupyter-env.html">2. The Jupyter Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-03-notebooks.html">3. Using Notebooks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-04-object-detection.html">4. Object Detection</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">2. Model Serving with OpenShift Data Science</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-01-model-api.html">1. Serving a Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-02-deploy-s2i.html">2. Deploy with Source to Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-03-testing-deployment.html">3. Testing the Deployment</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="2-04-calling-from-application.html">4. Calling from an Application</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">3. Running Offline Object Detection</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-01-running-the-model-offline.html">1. Running the Model Offline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-02-offline-scoring-pipelines.html">2. Offline Scoring Pipelines</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">4. Fine Tuning and Training a Model</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4-01-training-the-model.html">1. Training a Model</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Object Detection Workshop</a></li>
    <li>2. Model Serving with OpenShift Data Science</li>
    <li><a href="2-04-calling-from-application.html">4. Calling from an Application</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/mamurak/rhods-od-workshop/edit/master/docs/modules/ROOT/pages/2-04-calling-from-application.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">2.4 Calling the API from an Application</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have a working API serving predictions, we can call it from an application.</p>
</div>
<div class="paragraph">
<p>Until now, we have been using a route which exposes the service externally.  Sometimes, services don&#8217;t expose themselves outside the cluster.  We&#8217;ll deploy an application to the same project and can refer to it using its internal service name.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_verify_your_service_url"><a class="anchor" href="#_verify_your_service_url"></a>Verify your service URL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you followed previous naming instructions, your service should be <code><a href="http://object-detection-rest:8080" class="bare">http://object-detection-rest:8080</a></code>.  You can verify your rest service&#8217;s name and port on the service detail screen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the project topology, open your deployment&#8217;s detail screen. Check the service <strong>name</strong> and <strong>port</strong>.
Your internal URL will be <code><a href="http://&lt;service-name&gt;:&lt;service-port&gt" class="bare">http://&lt;service-name&gt;:&lt;service-port&gt</a>;</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/topology-rest-service.png" alt="alt text" width="700">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_front_end_application"><a class="anchor" href="#_create_the_front_end_application"></a>Create the Front End Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two options for creating the Front End Application. If you have time you can build this
NodeJS app from source like we did for the REST API. If however you are in a rush we can run
the application from a pre-built container which is much <strong>faster</strong>.</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_use-pre-built-container"></a>Use pre-built container</p>
</li>
<li>
<p><a id="tabset1_build-from-source"></a>Build from source</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_use-pre-built-container">
<div class="paragraph">
<p>We will create the test app using a pre-built container from a public container registry</p>
</div>
<div class="paragraph">
<p>From the <code>+Add</code> menu, click on the <code>Container images</code> tile:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/from-container-image.png" alt="alt text" width="800">
</div>
</div>
<div class="paragraph">
<p>Set the container location in the <code>Image name</code>field, enter: <code>quay.io/agroom/object-detection-app</code>.</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">quay.io/agroom/object-detection-app</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/deploy-image.png" alt="alt text" width="800">
</div>
</div>
<div class="paragraph">
<p>If you&#8217;ve entered the correct repository it will be marked as <strong>validated</strong> You can optionally set the
runtime icon from something other than OpenShift, in the example screen <strong>nodejs</strong> was chosen.</p>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_build-from-source">
<div class="paragraph">
<p>We will create the test app the exact same way we created the REST service, but instead, we&#8217;ll be creating an <code>object-detection-app</code></p>
</div>
<div class="paragraph">
<p>From the <code>+Add</code> menu, click on the <code>Import from Git</code> tile:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/from-git.png" alt="alt text" width="800">
</div>
</div>
<div class="paragraph">
<p>Now set the Git repo <code>Git Repo URL</code>field, enter: <code>https://github.com/rh-aiservices-bu/object-detection-app.git</code>.</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">https://github.com/rh-aiservices-bu/object-detection-app.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;ve entered the correct repository, the Node.js builder image will be selected since this front end application was written in Node.js.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/git-repo-app.png" alt="alt text" width="800">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_application"><a class="anchor" href="#_configuring_the_application"></a>Configuring the application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Don&#8217;t hit that <strong>Create</strong> button just yet. We have to configure the runtime aspects of the application, this is then the
same regardless of whether it came from source or a container.</p>
</div>
<div class="sect2">
<h3 id="_set_the_app_name"><a class="anchor" href="#_set_the_app_name"></a>Set the App Name</h3>
<div class="ulist">
<ul>
<li>
<p>By default, our new deployment will be added to the existing application <code>object-detection</code> we created during our previous app.  We can leave that as is.  Instead of <code>object-detection-app-git</code>, we can change the <strong>Name</strong> to  <code>object-detection-app</code>, but it&#8217;s not required.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/general-app.png" alt="alt text" width="700">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_route"><a class="anchor" href="#_route"></a>Route</h3>
<div class="paragraph">
<p>For the detection application we want a <strong>secure https</strong> Route so we will use the default - so no changes required.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_the_deployment_environment_variables"><a class="anchor" href="#_configure_the_deployment_environment_variables"></a>Configure the Deployment Environment Variables</h3>
<div class="paragraph">
<p>The application needs to know where to send its images for predictions. Earlier, we confirmed the service URL of the <code>object-detection-rest</code> deployment.  We&#8217;ll use that value and add <code>/predictions</code>.  This will tell our front end application where to send the images by setting the variable <code>OBJECT_DETECTION_URL</code> to <code><a href="http://&lt;service-name&gt;:&lt;service-port/predictions" class="bare">http://&lt;service-name&gt;:&lt;service-port/predictions</a></code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the <strong>Deployment</strong>  options to set an environment variable:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/create-app-deployment.png" alt="alt text" width="700">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Under <strong>Environment variables (runtime only)</strong>, create a Name / Value pair.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Name:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">OBJECT_DETECTION_URL</code></pre>
</div>
</div>
<div class="paragraph">
<p>Value:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">http://object-detection-rest:8080/predictions</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you named the rest services <code>object-detection-rest</code>, this value should be <code><a href="http://object-detection-rest:8080/predictions" class="bare">http://object-detection-rest:8080/predictions</a></code>.  If not, used the observed value.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/create-app-env-var.png" alt="alt text" width="800">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create"><a class="anchor" href="#_create"></a>Create</h3>
<div class="ulist">
<ul>
<li>
<p>Scroll down and click on <strong>Create</strong>:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/create-button.png" alt="alt text">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_checking_your_application"><a class="anchor" href="#_checking_your_application"></a>Checking your Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can see a new application has been created and is currently building.  Like before, wait for the build to complete and pods to deploy.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s2i/topology-app.png" alt="alt text" width="800">
</div>
</div>
<div class="paragraph">
<p>After the application is deployed to OpenShift click on the Route URL to launch the application.
Try it out from your laptop or phone with a camera.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t want to type that long Route URL into your phone browser, try converting it into a QR code for your smartphone, for instance with <a href="https://www.qr-code-generator.com">QR code generator</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Return here if you&#8217;re ready to move on to <a href="3-01-running-the-model-offline.html" class="xref page">offline scoring</a>.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="2-03-testing-deployment.html">3. Testing the Deployment</a></span>
  <span class="next"><a href="3-01-running-the-model-offline.html">1. Running the Model Offline</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
