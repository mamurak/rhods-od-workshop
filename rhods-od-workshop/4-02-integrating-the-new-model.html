<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4.2 Deploying and Integrating the New Model :: Object Detection Workshop</title>
    <link rel="canonical" href="https://mamurak.github.io/rhods-od-workshop/rhods-od-workshop/4-02-integrating-the-new-model.html">
    <link rel="prev" href="4-01-training-the-model.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://mamurak.github.io/rhods-od-workshop">Object Detection Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhods-od-workshop" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">1. Jupyter Notebooks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-01-project-setup.html">1. Setting up your Data Science Project</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-02-jupyter-env.html">2. The Jupyter Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-03-notebooks.html">3. Using Notebooks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="1-04-object-detection.html">4. Object Detection</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">2. Model Serving with OpenShift Data Science</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-01-model-api.html">1. Serving a Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-02-deploy-s2i.html">2. Deploying the Containerized Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-03-testing-deployment.html">3. Testing the Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="2-04-calling-from-application.html">4. Calling from an Application</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">3. Running Offline Object Detection</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-01-running-the-model-offline.html">1. Running the Model Offline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="3-02-offline-scoring-pipelines.html">2. Offline Scoring Pipelines</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">4. Fine Tuning and Training a Model</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="4-01-training-the-model.html">1. Training a Model</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="4-02-integrating-the-new-model.html">2. Deploying and Integrating the New Model</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Object Detection Workshop</a></li>
    <li>4. Fine Tuning and Training a Model</li>
    <li><a href="4-02-integrating-the-new-model.html">2. Deploying and Integrating the New Model</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/mamurak/rhods-od-workshop/edit/master/docs/modules/ROOT/pages/4-02-integrating-the-new-model.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">4.2 Deploying and Integrating the New Model</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We can now update the object detection application by deploying and integrating the new object detection model. The overall steps are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy and test the model using RHOAI Model Serving.</p>
</li>
<li>
<p>Reconfigure the model client to send its prediction requests to the new inference endpoint.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploy_and_test_the_model"><a class="anchor" href="#_deploy_and_test_the_model"></a>Deploy and test the model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can now follow the steps detailed in sectino 2.1 to deploy and test the new model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the model through the RHOAI dashboard. Enter the updated model artifact ID in the <code>Path</code>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/app/deploy-new-model.png" alt="alt text">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the <code>2_online-scoring</code> notebook. Enter the new model&#8217;s inference endpoint URL under <code>prediction_url</code> and update the class labels:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">class_labels = ['Laptop', 'Computer keyboard', 'Table']</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/app/updated_class_labels_in_notebook.png" alt="alt text">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Re-run the notebook to test the inference endpoint of the new deployed model.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reconfigure_the_model_client"><a class="anchor" href="#_reconfigure_the_model_client"></a>Reconfigure the model client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In section 2.2 we have deployed the model client. We don&#8217;t need to deploy it again but instead change its configuration parameters, specifically the inference endpoint and the class labels.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the OpenShift Console, navigate to <code>ConfigMaps</code> and <strong>create</strong> a new one (top right button) named <code>class-labels-secret</code> with key and value as indicated below:</p>
</li>
</ul>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">class-labels</code></pre>
</div>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">['Laptop', 'Computer keyboard', 'Table']</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/app/configmap.png" alt="alt text">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to <code>Topology</code>, select the <code>object-detection-rest</code> pod, select <code>Actions</code> in the right menu, and choose <code>Edit Deployment</code>.</p>
</li>
<li>
<p>Scroll down to <code>Environment Variables</code> and select <code>Add from ConfigMap or Secret</code>. Enter <code>CLASS_LABELS</code> as the name, and select the <code>class-labels-secret</code> CM and the <code>class-labels</code> value as follows:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/app/deployment.png" alt="alt text">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Finally, update the value of the <code>PREDICTION_URL</code> environment variable, using the inference endpoint URL of the new model.</p>
</li>
<li>
<p>Click <code>Save</code> to trigger the re-deployment of the model client with the updated configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the service has been redeployed and started consuming the new model through the new inference endpoint, you can test the changes brought by the new model using your camera or mobile device as before. You should now see new predictions based on your new model that was finetuned to detect laptops, computer keyboards, and tables.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/app/laptop-prediction.jpg" alt="alt text">
</div>
</div>
<div class="paragraph">
<p>Congratulations, you have finished this lab on deploying and updating an object detection application!</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="4-01-training-the-model.html">1. Training a Model</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
